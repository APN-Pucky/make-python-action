# action.yml
name: 'Make python'
description: 'make, make docs, make test and publish python code'
inputs:
  publish:
    default: false
  test:
    default: true
  doc:
    default: false

runs:
  using: "composite"
  steps:
    - name: work around permission issue
      run: git config --global --add safe.directory /__w/${{ github.event.repository.name }}/${{ github.event.repository.name }}
      shell: bash
    - uses: actions/checkout@v3
      with:
        fetch-depth: "0"
    - run: git fetch --depth=1 origin +refs/tags/*:refs/tags/*
      shell: bash

    - run: make build
      shell: bash
    - run: make install
      shell: bash
    - run: make test
      shell: bash
      if: ${{ inputs.test }}
    - name: Build Sphinx
      shell: bash
      if: ${{ inputs.doc }}
      run: rm -rf build && make clean-all && make html